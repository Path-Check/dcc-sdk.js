const {sign, verify, pack, unpack, signAndPack, unpackAndVerify, makeCWT, parseCWT, debug} = require('../lib/index');
const expect = require('chai').expect; 

describe('AT', async () => {
  it('should verify AT_2DCode_raw_1', async () => {
    const HC1 = 'HC1:NCFTW2H:7*I06R3W/J:O6:P4QB3+7RKFVJWV66UBCE//UXDT:*ML-4D.NBXR+SRHMNIY6EB8I595+6UY9-+0DPIO6C5%0SBHN-OWKCJ6BLC2M.M/NPKZ4F3WNHEIE6IO26LB8:F4:JVUGVY8*EKCLQ..QCSTS+F$:0PON:.MND4Z0I9:GU.LBJQ7/2IJPR:PAJFO80NN0TRO1IB:44:N2336-:KC6M*2N*41C42CA5KCD555O/A46F6ST1JJ9D0:.MMLH2/G9A7ZX4DCL*010LGDFI$MUD82QXSVH6R.CLIL:T4Q3129HXB8WZI8RASDE1LL9:9NQDC/O3X3G+A:2U5VP:IE+EMG40R53CG9J3JE1KB KJA5*$4GW54%LJBIWKE*HBX+4MNEIAD$3NR E228Z9SS4E R3HUMH3J%-B6DRO3T7GJBU6O URY858P0TR8MDJ$6VL8+7B5$G CIKIPS2CPVDK%K6+N0GUG+TG+RB5JGOU55HXDR.TL-N75Y0NHQTZ3XNQMTF/ZHYBQ$8IR9MIQHOSV%9K5-7%ZQ/.15I0*-J8AVD0N0/0USH.3';
    const cwtPayload = await unpackAndVerify(HC1);
    expect(cwtPayload).not.to.be.null;
    expect(cwtPayload).not.to.be.undefined;
    expect(await parseCWT(cwtPayload)).to.eql({'ver': '1.0.0', 'nam': {'fn': 'Musterfrau-Gößinger', 'fnt': 'MUSTERFRAU<GOESSINGER', 'gn': 'Gabriele', 'gnt': 'GABRIELE'}, 'dob': '1998-02-26', 'v': [{'tg': '840539006', 'vp': '1119305005', 'mp': 'EU/1/20/1528', 'ma': 'ORG-100030215', 'dn': 1, 'sd': 2, 'dt': '2021-02-18', 'co': 'AT', 'is': 'BMSGPK Austria', 'ci': 'urn:uvci:01:AT:10807843F94AEE0EE5093FBC254BD813P'}]});
  });

  it('should verify AT_2DCode_raw_2', async () => {
    const HC1 = 'HC1:NCFOXN%TS3DH3ZSUZK+.V0ETD%65NL-AH5*SIOOK.IR9B+9G4G50PHZF0AT4V22F/8X*G3M9FQH+4J/-K$+CY73JC3MD3IFTNAJSZ4EJ0NTI4L6-O16VH6ZL4XP:N6ON1 *L:O80R5LY5K%JLY5W0S./RPZ5JT9A/RF H ZP4UBKS5%%H/P5VV3HM4OH6*ZUFXFE.R:YN/P3JRH8LHGL2TK96L6SR9MU9DV5 R1BPIZKH05VW63LD3LS4JYK9EFH78$ZJ*DJ3Q4+Y5V$K2:6.77/Z6KZ5LD6E6P 9SH87/YQJ/RL35+Y5P Q*8D$JD IBCLCK5MJMS68H36DH.K:Z28AL**I3DN3F7MHFEVV%*4HBTSCNT 4C%C47TO*47*KB*KYQTHFTNS4.$S6ZC0JB%JBK:TBSH:GU$EPVDR2547EDRNPZ K/HN1*V:H1E8KPGJNL7/.NPMN2KPQJQFK1F%57MV0:6XBC-CWOTR18WOYF6J3$Z1*7RIXBBMH30ONWVPB9%30+9PL0';
    const cwtPayload = await unpackAndVerify(HC1);
    expect(cwtPayload).not.to.be.null;
    expect(cwtPayload).not.to.be.undefined;
    expect(await parseCWT(cwtPayload)).to.eql({'ver': '1.0.0', 'nam': {'fn': 'Musterfrau-Gößinger', 'fnt': 'MUSTERFRAU<GOESSINGER', 'gn': 'Gabriele', 'gnt': 'GABRIELE'}, 'dob': '1998-02-26', 'r': [{'tg': '840539006', 'fr': '2021-02-20', 'co': 'AT', 'is': 'BMSGPK Austria', 'df': '2021-04-04', 'du': '2021-10-04', 'ci': 'urn:uvci:01:AT:858CC18CFCF5965EF82F60E493349AA5Y'}]});
  });

  it('should verify AT_2DCode_raw_3', async () => {
    const HC1 = 'HC1:NCFOXN%TS3DH3ZSUZK+.V0ETD%65NL-AHNXHIOOW%ID3UQC0GJL/A55I1+QI6M8SA3/-2E%5TR5VVBFVAPUB1VCSWC%PDGZKBTC$JC6VCQVD. CL%2ZXIVVG2Z15ZM866-G9WC5OFU946+967KQZE9%UP3M104AM69 JU/V9355P1MO3Q$W5$25L7E-G9EB9/-11W50NPRN9F698.P-50B5HL4LQ/SLE50$499T8X3JZILDB57ABYIPZA 1JG71RCR5D6SSPW+QIHPZNQJ+Q8+PTGO9+P+*PIHPCNP81RP*OIHP*+RKHPS$RAC5887VJP7FRDEO+LO4%M*XKAL6AHLW 70SO:GOLIROGONP5X457VCE8C09DC8CUCII7JSTNCA799MC$Q3R69 OZDP*DPK+Q92SYW6MIRNCQIW6B95CAM7/2Q+8 CA:CADKL-$V4%D99TJX3DKB:ZJ83BDPSCFTB.SBVTHOJ92KNNSQBJGZIGOJ6NJF0JEYI1DLNCKUCI5OI9YI:8DGCDBZ1MSM%4HQ27ZV0I*0%S7K3ERIQ$IL0P6Y/B0U5L 6S%I4X6*-SU%AAMA$8QO4TD1S:I74$ULPF:1ET7PCDAAUA*.EIXMD8M82GG569MV -CQH1S0DTFJ';
    const cwtPayload = await unpackAndVerify(HC1);
    expect(cwtPayload).not.to.be.null;
    expect(cwtPayload).not.to.be.undefined;
    expect(await parseCWT(cwtPayload)).to.eql({'ver': '1.0.0', 'nam': {'fn': 'Musterfrau-Gößinger', 'fnt': 'MUSTERFRAU<GOESSINGER', 'gn': 'Gabriele', 'gnt': 'GABRIELE'}, 'dob': '1998-02-26', 't': [{'tg': '840539006', 'tt': 'LP6464-4', 'nm': 'Roche LightCycler qPCR', 'sc': '2021-02-20T12:34:56Z', 'dr': '2021-02-20T14:56:01Z', 'tr': '260415000', 'tc': 'Testing center Vienna 1', 'co': 'AT', 'is': 'BMSGPK Austria', 'ci': 'urn:uvci:01:AT:B5921A35D6A0D696421B3E24621782971'}]});
  });

  it('should verify AT_2DCode_raw_4', async () => {
    const HC1 = 'HC1:NCFOXN%TS3DH3ZSUZK+.V0ETD%65NL-AH8+UIOOW%ID3UQC0GJL/A55I1+QI6M8SA3/-2E%5TR5VVBFVAPUB1VCSWC%PDGZKBTC$JC6VCQVD. CL%2IZI+BJ*8DVWDZXIZVGT3ECKDU6CN*IXJAJKSI8CZJC:NKKMISMI-%32JB:NI+7JUCI1NJQMIFXKX1JKOJY7JN9CJZIF:1R$5BD79RO+YMHBQ:YMV97RFLBPPN*O8-RL1RMHPW+QK0P5IR1OR1NPG-RSGOV0QB+PRNQFNQU+QP1RJW6PTM3CQV27D 7:QB.KMIFNV35NC67Q4UYQD*O%+Q.SQBDO471XJCI.C$JC7KDF9C$ZJ*DJ3Q4+Y5V$K2:6.77/Z6KZ5LD6E6P 9SH87/YQJ/RL35+Y5P Q98D$JD IBCLCK5MJMS68HWH0ZSJJZIZ0KQPI59U%S2WPT YSLZI19JA2K7VA$IJVTIWVBDKBYLDN4D74DWZJ$7K+ CUED060U90N3149U2/KC*6J3BIZPBU9ZX5ZWCY5F..N ZF-HOM%A1-PI6OE2G7.RK$9BCUX6GB5U2+CS*RM.R$HV3 7SDP/RRQ-P BWC6DK7LUMADA9S 72II';
    const cwtPayload = await unpackAndVerify(HC1);
    expect(cwtPayload).not.to.be.null;
    expect(cwtPayload).not.to.be.undefined;
    expect(await parseCWT(cwtPayload)).to.eql({'ver': '1.0.0', 'nam': {'fn': 'Musterfrau-Gößinger', 'fnt': 'MUSTERFRAU<GOESSINGER', 'gn': 'Gabriele', 'gnt': 'GABRIELE'}, 'dob': '1998-02-26', 't': [{'tg': '840539006', 'tt': 'LP6464-4', 'ma': '1232', 'sc': '2021-02-20T12:34:56Z', 'dr': '2021-02-20T12:45:01Z', 'tr': '260415000', 'tc': 'Testing center Vienna 1', 'co': 'AT', 'is': 'BMSGPK Austria', 'ci': 'urn:uvci:01:AT:71EE2559DE38C6BF7304FB65A1A451ECE'}]});
  });

});

